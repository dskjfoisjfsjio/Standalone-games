<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Path of Survivor</title>
    <style>
      body { margin: 0; background: #000; color: #fff; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
      #status { text-align: center; }
      .progress { width: 250px; background: #222; height: 6px; margin-top: 15px; border-radius: 10px; overflow: hidden; }
      #bar { width: 0%; height: 100%; background: #00ffcc; transition: width 0.3s; }
      #canvas { width: 100%; height: 100%; background: #000; display: none; }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <div id="status">
      <div id="msg">Loading Path of Survivor</div>
      <div class="progress"><div id="bar"></div></div>
    </div>

    <script>
      const bar = document.getElementById("bar");
      const msg = document.getElementById("msg");
      const BASE = "https://cdn.jsdelivr.net/gh/dskjfoisjfsjio/Standalone-games@main/path%20of%20survivor/Build/";

      const FILES = {
        wasm: { 
          hash: "d9b51cc17e2ec724b77105cb592bd0fc", 
          name: "d9b51cc17e2ec724b77105cb592bd0fc.wasm", 
          parts: 4 
        },
        data: { 
          hash: "e687cc3ab50b03a0b168be40058141f4", 
          name: "e687cc3ab50b03a0b168be40058141f4.data", 
          parts: 1 
        }
      };

      async function merge(file, start, end) {
        let chunks = [];
        for (let i = 1; i <= file.parts; i++) {
          msg.innerText = `Fetching ${file.name.split('.').pop()} (${i}/${file.parts})`;
          const r = await fetch(`${BASE}${file.name}.part${i}`);
          if (!r.ok) throw new Error();
          chunks.push(new Uint8Array(await r.arrayBuffer()));
          bar.style.width = (start + ((i / file.parts) * (end - start))) + "%";
        }
        return URL.createObjectURL(new Blob(chunks, { type: 'application/octet-stream' }));
      }

      async function init() {
        try {
          const wBlob = await merge(FILES.wasm, 0, 50);
          const dBlob = await merge(FILES.data, 50, 90);

          const XHR = window.XMLHttpRequest;
          window.XMLHttpRequest = function() {
            const xhr = new XHR();
            const open = xhr.open;
            xhr.open = function(m, url) {
              let t = url;
              const filename = url.substring(url.lastIndexOf('/') + 1);
              if (filename.includes(FILES.wasm.hash)) t = wBlob;
              else if (filename.includes(FILES.data.hash)) t = dBlob;
              return open.apply(this, [m, t, ...Array.from(arguments).slice(2)]);
            };
            return xhr;
          };

          const config = {
            dataUrl: FILES.data.name,
            frameworkUrl: BASE + "8c180a588587fe378399baff362b2abb.framework.js",
            codeUrl: FILES.wasm.name,
            streamingAssetsUrl: "StreamingAssets",
            companyName: "DefaultCompany",
            productName: "Path of Survivor",
            productVersion: "1.0",
          };

          const s = document.createElement("script");
          s.src = BASE + "bb0d9ecdb05db3e84da20bd14a4f84dc.loader.js";
          s.onload = () => {
            createUnityInstance(document.getElementById("canvas"), config, (p) => {
              bar.style.width = (90 + (p * 10)) + "%";
            }).then(() => {
              document.getElementById("status").style.display = "none";
              document.getElementById("canvas").style.display = "block";
            });
          };
          document.body.appendChild(s);
        } catch (e) {
          msg.innerText = "Error Loading Game";
        }
      }

      init();
    </script>
  </body>
</html>
