import{currentPage as e,numToValuta as t,showPage as n,user as o}from"/script.js?v=2.19";import{getInventoryValue as i,getItem as r,renderItem as s,sellItems as l}from"/js/items.js?v=2.19";import{game as a}from"/js/game.js?v=2.19";import{Pages as c}from"/js/pages.js?v=2.19";import{alwaysCompact as d,setAlwaysCompact as u}from"/js/settings.js?v=2.19";import p from"/js/select.js?v=2.19";import{getCurrency as v}from"/js/prefs.js?v=2.19";let f=false;const m=c.createPage("inventory");const y=m.q(".inventory-management-controls");y.q("vertical-switch.compact-hide",{text:"Compact Mode",onchange(){u(this.state==="on");loadInv()},startState:d?"on":"off"});const h=y.q(".css-dropdown");const g=h.q("button.button");h.q(".css-dropdown-contents",[q("button","Decreasing Price ↘",{onclick:()=>(G="PriceDescending")&&loadInv()}),q("button","Increasing Price ↗",{onclick:()=>(G="PriceAscending")&&loadInv()}),q("button","Decreasing Rarity ↘",{onclick:()=>(G="RarityDescending")&&loadInv()}),q("button","Increasing Rarity ↗",{onclick:()=>(G="RarityAscending")&&loadInv()}),q("button","Alphabetic A-Z",{onclick:()=>(G="A-Z")&&loadInv()}),q("button","Alphabetic Z-A",{onclick:()=>(G="Z-A")&&loadInv()}),q("button","Cases First",{onclick:()=>(G="CasesFirst")&&loadInv()})]);const b=y.q(".css-dropdown");const x=b.q("button.button#sell-dbtn",{text:"Sell..."});const k=b.q(".css-dropdown-contents");k.q("button",{text:"Sell all under "+t(1e3,2),onclick(){l(o.inventory.filter((e=>r(e).price<1e3)))}});k.q("button",{text:"Sell all under "+t(5e3,2),onclick(){l(o.inventory.filter((e=>r(e).price<5e3)))}});k.q("button",{text:"Sell all under "+t(25e3,2),onclick(){l(o.inventory.filter((e=>r(e).price<25e3)))}});const w=document.body.q(".dialog.mso-dialog");w.q(".dialog-header","Sell Options");const I=w.q(".mso-row");const M=I.q("input.mso-radio",{type:"radio",name:"mso-selection"});I.q("p","Sell everything under ");let A=1e3;I.q("input.mso-inline-input",{type:"text",value:"10.00",onblur(){this.value=(A/100).toFixed(2)},oninput(){A=Math.round(parseFloat(this.value)*100);M.checked=true}});I.q("p",v());const P=w.q(".mso-row");const C=P.q("input.mso-radio",{type:"radio",name:"mso-selection"});P.q("p","Sell everything with ");const R=P.q("select.mso-inline-select",{value:0,oninput(){C.checked=true},children:[q("option",{value:0,text:"Consumer (White)",style:{color:"#fff"}}),q("option",{value:1,text:"Industrial (Light Blue)",style:{color:"#99f"}}),q("option",{value:2,text:"Milspec (Blue)",style:{color:"#33f"}}),q("option",{value:3,text:"Restricted (Purple)",style:{color:"#84f"}}),q("option",{value:4,text:"Classified (Magenta)",style:{color:"#f5f"}}),q("option",{value:5,text:"Covert (Red)",style:{color:"#f22"}}),q("option",{value:6,text:"Exceedingly Rare (Yellow)",style:{color:"#fd0"}})]});P.q("p"," rarity");const j=w.q(".mso-row");const S=j.q("input.mso-radio",{type:"radio",name:"mso-selection"});j.q("p","Sell everything cheaper or equal to the");let L=0;j.q("input.mso-inline-input",{type:"text",value:"0",style:{width:"40px"},onblur(){this.value=L},oninput(){L=parseInt(this.value);D.innerText=(L===1?"-st":L===2?"-nd":"-th")+" item in your inventory (<= "+v(r(o.inventory.sort(((e,t)=>r(t).price-r(e).price))[L-1]).price)+")";S.checked=true}});let D=j.q("p","-th item in your inventory");const F=w.q(".mso-row");const Z=F.q("input#mso-4.mso-radio",{type:"radio",name:"mso-selection"});F.q("label",{attr:{for:"mso-4"},text:"Sell everything"});const T=w.q(".mso-row");const E=T.q("input#mso-5.mso-radio:checked",{type:"radio",name:"mso-selection"});T.q("label",{attr:{for:"mso-5"},text:"Sell keys and cases"});w.q("button.button",{text:"Sell",onclick(){if(M.checked){l(o.inventory.filter((e=>r(e).price<A)))}else if(C.checked){l(o.inventory.filter((e=>r(e).rarity===parseInt(R.value))))}else if(S.checked){let e=r(o.inventory.sort(((e,t)=>r(t).price-r(e).price))[L-1]).price;l(o.inventory.filter((t=>r(t).price<=e)))}else if(Z.checked){l(o.inventory)}else if(E.checked){l(o.inventory.filter((e=>r(e).type==="key"||r(e).type==="case"||r(e).type==="capsule")))}}});w.q("button.dialog-close.button","Close",{onclick(){w.classList.remove("dialog-open")}});window.addEventListener("mousedown",(e=>{let t=true;let n=e.target;while(t&&n&&n!==document)if(n===w)t=false;else n=n.parentNode;if(t)w.classList.remove("dialog-open")}));a.on("showPage",(({page:e})=>e!=="inventory"&&w.classList.remove("dialog-open")));k.q("button",{text:"More Options...",onclick(){E.checked=true;w.classList.add("dialog-open")}});const H=y.q("button.button",{text:"< Prev"});const W=y.q("input.num-input",{onclick(){W.value=U+1;W.select()}});const N=y.q("button.button",{text:"Next >"});const V=y.q("button.button",{text:"F",onclick(){f=!f;loadInv()}});let z="";const B=y.q("button.button",{html:'<img src="images/search.png">',onclick(){if(Y.hidden){Y.hidden=false;$.style.display="none";Y.select();z=Y.value.replace(/[^A-z0-9]/g,"");loadInv()}else{Y.hidden=true;$.style.display="flex";z="";loadInv()}}});const Y=y.q("input.input.imc-search-input",{html:'<img src="images/search.png">',oninput(){z=this.value.toLowerCase().replace(/[^a-z0-9]/g,"");loadInv()},hidden:true});const $=y.q(".imc-text",{text:"Inv Value: ..."});const O=m.q(".inventory-container");let U=0;let G="CasesFirst";let J={PriceDescending:"Decreasing Price",PriceAscending:"Increasing Price",RarityDescending:"Decreasing Rarity",RarityAscending:"Increasing Rarity","A-Z":"Alphabetic","Z-A":"Alphabetic Reverse",CasesFirst:"Cases First"};export function loadInv(){o.favinv??=[];x.disabled=f;V.innerHTML=f?"Back":'<img src="images/favorites.png">';let e=f?o.favinv:o.inventory;if(z)e=e.filter((e=>e.toLowerCase().replace(/[^a-z0-9]/g,"").includes(z)));let n=e.length;let l={};let a={};e=e.filter((e=>{if(a[e]===undefined){let t=r(e);if(t.type!=="case"&&t.type!=="capsule"&&t.type!=="key"){a[e]=true;return true}else{a[e]=false}}else if(a[e])return true;if(l[e]){l[e]++;n--;return false}l[e]=1;return true}));let c=d||window.innerHeight<=850||window.innerWidth<=1150?Math.max(1,Math.floor((window.innerHeight-55)/192))*Math.max(1,Math.floor(p("#pages").offsetWidth/112)):Math.max(1,Math.floor((window.innerHeight-55)/265))*Math.max(1,Math.floor(p("#pages").offsetWidth/177));let u=n/c;if(U<0)U=0;if(U>Math.ceil(u)-1)U=Math.ceil(u)-1;if(document.activeElement!==W)W.value=U+1+" / "+Math.ceil(u);N.disabled=U===Math.ceil(u)-1;H.disabled=U===0;g.innerText="Sort: "+J[G];if(G==="PriceDescending")e.sort(((e,t)=>r(t).price-r(e).price));else if(G==="PriceAscending")e.sort(((e,t)=>r(e).price-r(t).price));else if(G.endsWith("Ascending"))e.sort(((e,t)=>r(e).price-r(t).price));else e.sort(((e,t)=>r(t).price-r(e).price));if(G==="RarityDescending")e.sort(((e,t)=>r(t).rarity-r(e).rarity));else if(G==="RarityAscending")e.sort(((e,t)=>r(e).rarity-r(t).rarity));else if(G==="A-Z")e.sort(((e,t)=>{e=r(e).name;t=r(t).name;return e>t?1:e<t?-1:0}));else if(G==="Z-A")e.sort(((e,t)=>{e=r(e).name;t=r(t).name;return e>t?-1:e<t?1:0}));else if(G==="CasesFirst")e.sort(((e,t)=>{let{type:n}=r(e);if(n==="case")return-1;if(n==="capsule")return-1;return 0}));O.innerHTML="";if(e.length===0)O.q(".inventory-note",f?"You have no favorites":"Your inventory is empty, go to the shop to buy cases.");for(let t=Math.max(U*c,0);t<Math.min((U+1)*c,e.length);t++){const n=r(e[t]);if(l[e[t]]){O.appendChild(s(n,{sell:!f,amount:l[e[t]],owned:true,favorite:f}))}else{O.appendChild(s(n,{sell:!f,owned:true,favorite:f}))}}if(f)$.innerText=`Inv Value: ${t(i(true),2)}\nFav-only Value: ${t(i(true,true),2)}`;else $.innerText=`Inv Value: ${t(i(true),2)}`}a.on("showPage",(e=>e.page==="inventory"&&loadInv()));H.onclick=()=>{U-=1;loadInv()};N.onclick=()=>{U+=1;loadInv()};W.oninput=()=>{U=parseInt(W.value)-1||0;loadInv()};W.onblur=()=>{loadInv()};a.emit("update");window.addEventListener("keydown",(t=>{if(document.activeElement.tagName==="INPUT")return;if((e!=="inventory"||f!==true)&&t.key==="f"){f=true;n("inventory")}if((e!=="inventory"||f!==false)&&t.key==="i"){f=false;n("inventory")}}));