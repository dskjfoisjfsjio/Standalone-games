import{goToPreviousPage as t,numToString as e,user as s}from"/script.js?v=2.19";import{game as o}from"/js/game.js?v=2.19";import{addStat as n}from"/js/stats.js?v=2.19";import{openWithdrawPrompt as i,tradeIn as l}from"/js/casino.js?v=2.19";import{Pages as a}from"/js/pages.js?v=2.19";import{getCurrency as r}from"/js/prefs.js?v=2.19";const c=a.createPage("mines").q(".center");c.q("h1",{text:"Mines"});const u=c.q(".coins",{text:"You have x chips."});o.on("update",(()=>{u.innerText=`You have ${e(s.tokens)} chips.`}));const m=.992;c.q([q("button.button",{text:"Back",onclick(){t()}}),q("button.button",{text:"Trade in Skins to Chips",onclick(){l()}}),q("button.button",{text:"Withdraw Chips to "+r(),onclick(){i()}})]);const f=c.q(".mines-body");const d=f.q(".mines-left-column");d.q("p.mines-description",{text:"In Mines, your objective is to uncover as many tiles as possible, without choosing a bomb. If you choose a bomb your bet is lost. The more tiles you uncover, the higher your bet multiplier gets. You can cash out at any time before hitting a bomb. Your multiplier grows faster if you have more bombs on the board."});d.q("p.label",{text:"Enter the amount you want to bet"});const b=d.q("");const p=b.q("input.input.column-margin",{value:10,oninput(){if(_==="ended"){I=parseInt(this.value)||0;if(I>Math.floor(s.tokens))I=Math.floor(s.tokens);if(s.upgrades.maxbet!==-1&&I>Math.floor(s.upgrades.maxbet/100*8))I=Math.floor(s.upgrades.maxbet/100*8)}},onblur(){this.value=I}});b.q("button.button.combo-button",{text:"All-in",onclick(){if(_==="ended"){I=Math.floor(s.tokens);p.value=I}}});o.on("showPage",(t=>{if(t.page==="mines"&&_==="ended"){I=Math.min(10,Math.floor(s.tokens));p.value=I}}));d.q("p.label",{text:"Enter the amount of bombs you want"});const h=d.q(".select-combo.column-margin");const g=h.q("button.button",{text:"1",onclick(){if(_==="ended"){L=1;C()}}});const x=h.q("button.button",{text:"3",onclick(){if(_==="ended"){L=3;C()}}});const v=h.q("button.button",{text:"5",onclick(){if(_==="ended"){L=5;C()}}});const k=h.q("input.input",{placeholder:"Custom Amount",value:10,css:{width:"30px"},oninput(){if(_==="ended"){L=parseInt(this.value)||1;C()}},onblur(){if(_==="ended"){L=parseInt(this.value)||1;if(L>23)L=23;this.value=L;C()}},onfocus(){if(_==="ended"){if(this.value)L=parseInt(this.value)||1;C()}}});const y=d.q("button.button.column-margin",{text:"Play",onclick(){if(_==="ended")z();else if(T!==1)$()}});const M=f.q(".mines-tiles-container");let _="ended";let j=false;let L=1;let w=24;let T=1;let I=10;let P=null;function C(){g.classList.remove("selected");x.classList.remove("selected");v.classList.remove("selected");k.classList.remove("selected");if(L===1)g.classList.add("selected");else if(L===3)x.classList.add("selected");else if(L===5)v.classList.add("selected");else k.classList.add("selected");if(_==="started"){if(w!==24)y.innerText="Cash out "+Math.floor(I*(1/T*m))+" C.";else y.innerText="Press a tile..."}else y.innerText=j?"Play again":"Play";M.classList.toggle("mines-game-ended",_==="ended")}function Y(t){let e=false;const s=M.q(".mines-tile",{css:{top:Math.floor(t/5)*100+"px",left:t%5*100+"px"},onclick(){if(e)return;if(_==="started"){e=true;let s=Math.random();if(L/w>=s){this.classList.add("mines-bomb");S()}else{this.classList.add("mines-cleared");T*=(w-L)/w;w--;P.innerText=(1/T*m).toFixed(2)+"x";P.style.top=Math.floor(t/5)*100+"px";P.style.left=t%5*100+"px";P.style.transition="0s";P.style.fontSize=0;setTimeout((()=>{P.style.transition="0.1s font-size";P.style.fontSize=40-(w-L)*1.5+"px"}),100);if(w===L)$();C()}}}});if(t<12)s.style.backgroundImage=`url(/images/bombsites/${t+1}.png)`;else if(t>12)s.style.backgroundImage=`url(/images/bombsites/${t}.png)`}function z(){if(I<=0)return;if(I>s.tokens)return;s.tokens-=I;n("spend_chips",I);if(L>23)L=23;else if(L<1)L=1;w=24;T=1;_="started";M.innerHTML="";for(let t=0;t<25;t++){if(t===12)continue;Y(t)}P=M.q(".mines-multiplier");C();o.emit("update")}function S(){_="ended";if(I>Math.floor(s.tokens))I=Math.floor(s.tokens);p.value=I;j=true;n("total_mines_games",1);n("total_mines_lost",1);C()}function $(){_="ended";j=true;s.tokens+=Math.floor(I*(1/T*m));n("win_chips",Math.floor(I*(1/T*m)));if(1/T*m>20)n("total_mines_won_mo20",1);n("total_mines_games",1);n("total_mines_won",1);C();o.emit("update")}C();