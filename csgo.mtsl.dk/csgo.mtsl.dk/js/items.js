import{goToPreviousPage as e,numToString as t,numToValuta as n,showPage as i,user as r}from"/script.js?v=2.19";import{items as o}from"/data/items.js?v=2.19";import{setStat as s,addStat as l}from"/js/stats.js?v=2.19";import c from"/js/select.js?v=2.19";import{game as a}from"/js/game.js?v=2.19";import{displayWinnings as m}from"/js/winnings.js?v=2.19";import{Pages as u}from"/js/pages.js?v=2.19";export const itemRarity={0:{color:"#fff",name:"consumer",display:"Consumer"},1:{color:"#99f",name:"industrial",display:"Industrial"},2:{color:"#33f",name:"milspec",display:"Milspec"},3:{color:"#84f",name:"restricted",display:"Restricted"},4:{color:"#f5f",name:"classified",display:"Classified"},5:{color:"#f22",name:"covert",display:"Covert"},6:{color:"#fd0",name:"exceedinglyrare",display:"Exceedingly Rare"},7:{color:"#fc7",name:"contraband",display:"Contraband"}};const f={consumer:0,industrial:1,milspec:2,restricted:3,classified:4,covert:5,exceedinglyrare:6,contraband:7};export const itemQualities={1:"Battle-Scarred",2:"Well-Worn",3:"Field-Tested",4:"Minimal Wear",5:"Factory New"};export const itemQualitiesShort={1:"BS",2:"WW",3:"FT",4:"MW",5:"FN"};export function getItem(e){if(typeof e==="object")return e;else if(o[e])return o[e];else return{quality:"Unknown",short:e,skin:"Unknown Item",weapon:"Unknown Item",name:"Unknown Item",src:"/images/missing.png",type:"skin",rarity:0,price:1,isUnknown:true}}export function renderItem(e,t){let o=q(".item-container");o.classList.toggle("no-optional-compact",t?.noOptionalCompact||false);let s=o.q(".item",{style:{borderColor:itemRarity[e.rarity].color}});if(!t||t.clickable!==false){s.onclick=t&&t.onclick?()=>t.onclick(e):()=>{if(t&&t.owned)i("inspect$"+e.name+"&owned");else i("inspect$"+e.name)}}let l=s.q(".item-image",{style:{backgroundImage:`url("${e.src}")`}});if(e.quality)l.q(".item-quality",itemQualitiesShort[e.quality]);if(e.stattrak)s.q(".item-stattrak");if(e.souvenir){l.style.boxShadow="1px 0 16px #fc04 inset";s.q(".item-souvenir","Souvenir")}if(t?.amount>1)l.q(".item-amount-text","x"+t.amount);if(t&&t.pricing)s.q(".item-price",n(e.price,2));const c=s.q(".item-text");c.q(".item-type",e.type==="skin"?e.weapon:e.type==="sticker"?e.stickerType:e.type[0].toUpperCase()+e.type.substring(1));c.q(".item-name",e.skin||e.sticker||e.short||e.name);if(t&&t.sell){if(t?.amount>1){o.q("button.button.item-sell","Sell all for "+n(e.price*t.amount,2),{onclick:()=>sellItems(new Array(t.amount).fill(e.name))})}else{o.q("button.button.item-sell","Sell for "+n(e.price,2),{onclick:()=>sellItems(e.name)})}}if(t&&t.buy){o.q("button.button.item-buy",{html:`${t.buyAmount>1?"Buy "+t.buyAmount+"x":"Buy"} for ${n(Math.floor(t.buyPrice)*t.buyAmount,2)}${t.preDiscountPrice?' <span style="text-decoration:line-through">'+n(Math.floor(t.preDiscountPrice)*t.buyAmount,2)+"</span>":""}`,onclick:()=>!t.buyDisabled&&buyItems(e,true,t.buyAmount,Math.floor(t.buyPrice)),disabled:r.money<Math.floor(t.buyPrice)*(t.buyAmount||1)})}if(t&&t.owned)o.q(".item-set-fav",{onclick:()=>$(e.name),tip:"Add to favorites",tipPosition:"center"});if(t&&t.owned&&t.favorite)o.q(".item-set-fav.fav",{onclick:()=>E(e.name),tip:"Remove from favorites",tipPosition:"center"});const a=s.q(".item-3d-shine-effect");o.onmouseleave=()=>{s.classList.add("transform-ended");s.style.transform="rotateY(0deg) rotateX(0deg) scale(1)";a.style.opacity=0};o.addEventListener("mousemove",(e=>{if(graphicsLevel>1){const t=s.getBoundingClientRect();if((e.y-t.y)/t.height<=1){s.classList.remove("transform-ended");let n=(e.x-t.x)/t.width-.5;let i=(e.y-t.y)/t.height-.5;s.style.transform="rotateY("+n*20+"deg) rotateX("+-i*20+"deg) scale(1.05)";a.style.opacity=1;a.style.top=Math.min(0,-i*100-50)+"%";a.style.left=-n*100-50+"%"}else{s.classList.add("transform-ended");s.style.transform="rotateY(0deg) rotateX(0deg) scale(1)";a.style.opacity=0}}}));return o}export function buyItems(e,t,n=1,i){if(t&&r.money<i*n)return false;n=Math.min(n,Math.floor(r.money/i));if(n>=1){r.money-=i*n;giveItem(e.name,n)}a.emit("update");return true}let p=false;export function sellItems(e){if(p)return;p=true;if(!Array.isArray(e))e=[e];else e=[...e];e.sort();r.inventory.sort();function t(e,t){let n=1;let i=t.indexOf(e);for(let r=i+1;r<t.length;r++){if(t[r]!==e)break;n++}return{x:n,s:i}}function n(n){let i=t(n,e);let o=t(n,r.inventory);let s=Math.min(i.x,o.x);e.splice(i.s,i.x);r.inventory.splice(o.s,s);let c=getItem(n);r.money+=c.price*s||0;if(c.type==="skin"||c.type==="sticker"){l("skin_sold",s);l("earnings_from_skin_sales",c.price*s);l("earned_cash",c.price*s);if(c.price>1e3)l("skin_sold_gt10",s);if(c.price>5e3)l("skin_sold_gt50",s);if(c.price>25e3)l("skin_sold_gt250",s);l("skin_sold_r"+c.rarity,s)}}while(e.length){n(e[0])}p=false;a.emit("update")}const d=u.createPage("selectItems");d.q("button.button.back-btn",{text:"Back",onclick(){e()}});const g=d.q(".center");g.q("h1.select-items-header",{text:"Select Items"});const y=g.q("p.select-items-info",{text:""});const h=g.q(".select-items-controls");const v=h.q(".select-items-controls-left");const I=v.q(".css-dropdown");const b=I.q("button.button",{text:"Filter"});const x=I.q(".css-dropdown-contents");const k=v.q("button.button",{text:"Prev"});const M=v.q("input.num-input",{onclick(){this.select()}});const w=v.q("button.button",{text:"Next"});const T=h.q(".select-items-controls-right");const A=T.q("button.button",{text:"Clear"});const C=T.q("button.button",{text:"Prev"});const S=T.q("input.num-input",{onclick(){this.select()}});const j=T.q("button.button",{text:"Next"});const _=T.q("button.button",{text:"All In"});const L=T.q("button.button",{text:"Auto Bet"});const O=d.q(".flex");const R=O.q("#select-owned-items.compact");const W=O.q("#select-selected-items.compact");const F=d.q(".center").q();F.q("button.button",{text:"Cancel",onclick(){e()}});const P=F.q("button.button",{text:"Confirm"});export function selectItems(e=0,o=false,s=1e3,l=1,a=false,m=true,u=false){return new Promise((p=>{i("selectItems",true);if(o<=0)o=false;if(e)y.innerText=o?"Make a bet between "+n(e,2)+" â€“ "+n(o,2):"Make a bet over "+n(e,2);else y.innerText=a?"Select items to trade up. They should be the same tier. For now you can mix stattrak/non-stattrak skins.":"Select items"+(m?" for your bet.":u?" to convert to chips.":".");let g=0;let h=0;let v="auto";x.innerHTML="";x.q("button",{text:"All",onclick(){v="none";F()}});x.q("button",{text:"Auto",onclick(){v="auto";F()}});for(let e=0;e<7;e++){x.q("button",{text:"Only "+itemRarity[e].display,style:{color:itemRarity[e].color},onclick(){v="tier:"+itemRarity[e].name;F()}})}w.onclick=()=>{g++;F()};k.onclick=()=>{g--;F()};M.oninput=()=>{g=M.value-1||0;F()};M.onfocus=()=>{M.value=g+1};M.onblur=()=>{F()};A.onclick=()=>{I=[];q=0;T=0;O=Array.from(r.inventory).filter((e=>{let t=getItem(e);if(t.type==="skin"||t.type==="sticker"){q+=t.price;return true}else return false}));F()};_.onclick=()=>{q=0;T=0;O=[];I=Array.from(r.inventory).filter((e=>{let t=getItem(e);if(t.type==="skin"||t.type==="sticker"){T+=t.price;return true}else return false}));F()};_.style.display=u||m?"initial":"none";j.onclick=()=>{h++;F()};C.onclick=()=>{h--;F()};S.oninput=()=>{h=S.value-1||0;F()};S.onfocus=()=>{S.value=h+1};S.onblur=()=>{F()};L.onclick=()=>{q=0;T=0;O=[];I=[];Array.from(r.inventory).sort(((e,t)=>getItem(t).price-getItem(e).price)).forEach((e=>{let t=getItem(e);if((t.type==="skin"||t.type==="sticker")&&(!o||T+t.price<o)&&I.length<s){I.push(e);T+=t.price}else{O.push(e);q+=t.price}}));F()};L.style.display=m?"initial":"none";let I=[];let q=0;let T=0;let O=Array.from(r.inventory).filter((e=>{let t=getItem(e);if(t.type==="skin"||t.type==="sticker"){q+=t.price;return true}else return false})).sort(((e,t)=>{let n=getItem(e).name;let i=getItem(t).name;if(n<i)return 1;if(n>i)return-1;return 0})).sort(((e,t)=>getItem(t).price-getItem(e).price));function F(){let i=[...O.filter((e=>{const t=getItem(e);return t.type==="skin"||t.type==="sticker"}))];b.innerText=v==="none"?"Filter: All":v;if(v.startsWith("tier:")){let e=v.substring(5);b.innerText="Filter: "+itemRarity[f[e]].display;i=i.filter((t=>getItem(t).rarity===f[e]))}else if(v==="auto"){b.innerText="Filter: Auto";if(I[0]){if(a){let e=getItem(I[0]).rarity;i=i.filter((t=>getItem(t).rarity===e))}}if(o)i=i.filter((e=>getItem(e).price+T<o));if(a){i=i.filter((e=>getItem(e).rarity!==5&&getItem(e).rarity!==6&&getItem(e).rarity!==7&&getItem(e).rarity!==8))}}if(O.length-i.length>0)b.q("span.btn-small-text","Hid "+(O.length-i.length)+" item"+(O.length-i.length===1?"":"s"));b.classList.toggle("button-active",v!=="none"&&v!=="auto"||O.length-i.length>0);let p=Math.floor(c("#pages").offsetWidth/2/118)*Math.floor((c("#pages").offsetHeight-246)/146);if(g<0)g=0;if(g>Math.ceil(i.length/p)-1)g=Math.ceil(i.length/p)-1;if(h<0)h=0;if(h>Math.ceil(I.length/p)-1)h=Math.ceil(I.length/p)-1;let d=false;if(a){let e=false;I.forEach((t=>{if(d)return;if(e===false)e=getItem(t).rarity;if(e!==getItem(t).rarity)d="NST";if(getItem(t).rarity>4)d="NUT"}))}P.disabled=I.length===0||T<e||o&&T>o||I.length>s||I.length<l||d;if(I.length===0)P.innerText="Select at least one item";else if(d==="NST")P.innerText="All selected items must be of the same tier";else if(d==="NUT")P.innerText="Some selected items cannot be used";else if(I.length>s)P.innerText="You cannot "+(m?"bet":"select")+" over "+s+" items";else if(I.length<l)P.innerText="You have to "+(m?"bet":"select")+" atleast "+l+" items";else if(T<e)P.innerText="You must "+(m?"bet":"select")+" a minimum of "+n(e,2);else if(o&&T>o)P.innerText="You must "+(m?"bet":"select")+" a maximum of "+n(o,2);else P.innerText="Confirm Selection";if(document.activeElement!==M)M.value=g+1+" / "+Math.ceil(i.length/p);w.disabled=g===Math.ceil(r.inventory.length/p)-1;k.disabled=g===0;if(document.activeElement!==S)S.value=h+1+" / "+Math.ceil(I.length/p);j.disabled=h===Math.ceil(r.inventory.length/p)-1;C.disabled=h===0;R.innerHTML=`<div class="select-cat">Your Items (${n(q,2)})</div>`;W.innerHTML=`<div class="select-cat">Selected Items (${n(T,2)}${u?" - "+t(Math.round(T/100*8))+" Chips":""})</div>`;i.sort(((e,t)=>{if(getItem(e).price<getItem(t).price)return 1;if(getItem(e).price>getItem(t).price)return-1;return 0}));I.sort(((e,t)=>{if(getItem(e).price<getItem(t).price)return 1;if(getItem(e).price>getItem(t).price)return-1;return 0}));for(let e=Math.max(0,g*p);e<Math.min((g+1)*p,i.length);e++){R.appendChild(renderItem(getItem(i[e]),{pricing:true,onclick:()=>{let t=i[e];I.push(t);q-=getItem(t).price;T+=getItem(t).price;O.splice(O.indexOf(t),1);F()}}))}for(let e=Math.max(0,h*p);e<Math.min((h+1)*p,I.length);e++){W.appendChild(renderItem(getItem(I[e]),{pricing:true,onclick:()=>{O.push(I[e]);q+=getItem(I[e]).price;T-=getItem(I[e]).price;I.splice(e,1);F()}}))}}function Y(){let t=false;if(a){let e=false;I.forEach((n=>{if(e===false)e=getItem(n).rarity;if(e!==getItem(n).rarity)t=true}))}if(I.length>=l&&I.length<=s&&T>=e&&(!o||T<=o)&&!t){d.classList.add("hide");R.innerHTML=`<div class="select-cat">Your Items (${n(q,2)})</div>`;W.innerHTML=`<div class="select-cat">Selected Items (${n(T,2)})</div>`;p(I.map((e=>getItem(e))))}}P.disabled=true;P.onclick=Y;F();d.classList.remove("hide")}))}export function getItemsValue(e){let t=0;e.forEach((e=>t+=getItem(e).price||0));return t}export function getItemsWorth(e){let t=[];let n=Object.values(o).filter((t=>t.type==="skin"&&!t.masterItem&&t.price<e*1.05&&(e<1e3||t.price>500)));while(e>10){let i=n[Math.floor(Math.random()*n.length)];if(i.weight&&i.weight<Math.random())continue;t.push(i);e-=t[t.length-1].price;l("total_winnings",t[t.length-1].price)}return t}export function giveItemsWorth(e){i("winnings");const t=getItemsWorth(e);t.forEach((e=>giveItem(e.name)));m({title:"Winnings",returnBtn:{text:"Go to inventory",page:"inventory"},items:t,sortBy:"value"})}export function removeItemsFromInventory(e){for(let t=0;t<e.length;t++){let n=r.inventory.indexOf(e[t]);if(n===-1)r.money-=getItem(e[t]).price;else r.inventory.splice(r.inventory.indexOf(e[t]),1)}}export function giveItem(e,t=1,n=false){for(let c=0;c<t;c++)r.inventory.push(e);let o=getItem(e).short||e;r.discoveredItems??=[];if(!r.discoveredItems.includes(o))r.discoveredItems.push(o);s("items_discovered",r.discoveredItems.length);s("skins_discovered",r.discoveredItems.filter((e=>{const t=getItem(e);return t?.type==="skin"})).length);s("stickers_discovered",r.discoveredItems.filter((e=>{const t=getItem(e);return t?.type==="sticker"})).length);if(n){const a=document.body.q(".popup-container",{onclick(e){if(e.target===a)l()}});const m=a.q(".popup-content");m.q("button.popup-exit-button",{onclick(){l()}});m.q("h1",{text:t>1?"You got "+t+":":"You got!"});const u=renderItem(getItem(e),{owned:true});u.addEventListener("click",l);m.appendChild(u);m.q("button.button",{text:"Open Inventory",onclick(){i("inventory");l()}});function l(){a.classList.add("popup-closed");setTimeout((()=>{document.body.removeChild(a)}),250)}}}let Y={};export function getItemContainer(e,t,n){const i=getItem(e).short||getItem(e).name;if(t){if(Y[e+"-"+n])return Y[e+"-"+n]?[...Y[e+"-"+n]]:false;const t=[];const r=Object.values(o).filter((e=>e.type==="case"||e.type==="capsule"));for(let e=0;e<r.length;e++){if(r[e].content.items.map((e=>o[e].short||o[e].name)).includes(i)&&t.push(r[e].name)>=n)break}Y[e+"-"+n]=t.length===0?false:t;return Y[e+"-"+n]?[...Y[e+"-"+n]]:false}const r=Object.keys(o).filter((e=>(o[e].type==="case"||o[e].type==="capsule")&&o[e].content.items.includes(i)));return r.length===0?false:r}export function getInventoryValue(e=false,t=false){r.favinv??=[];let n=0;let i=t?r.favinv:[...r.inventory,...r.favinv];for(let t=0;t<i.length;t++){let r=getItem(i[t]);if(e||r.type!=="case"&&r.type!=="capsule")n+=r.price}return n}function $(e){r.favinv??=[];r.favinv.push(e);removeItemsFromInventory([e]);a.emit("update")}function E(e){r.favinv??=[];giveItem(e);r.favinv.splice(r.favinv.indexOf(e),1);a.emit("update")}export function getRandomRarity(e){const t=Object.values(o).filter((t=>t.rarity===e&&!t.masterItem));return t[Math.floor(Math.random()*t.length)].name}