import{getItem as e,giveItem as t,itemQualities as n,itemRarity as i,renderItem as s}from"/js/items.js?v=2.19";import{createNotification as o}from"/js/notifications.js?v=2.19";import{addStat as a}from"/js/stats.js?v=2.19";import{game as r}from"/js/game.js?v=2.19";import{showPage as l,user as f}from"/script.js?v=2.19";import{displayWinnings as p}from"/js/winnings.js?v=2.19";import{Pages as c}from"/js/pages.js?v=2.19";import{alwaysCompact as m}from"/js/settings.js?v=2.19";import{global as d}from"/script.js?v=2.19";const u=c.createPage("opencase").q(".opencase-wheels");let h=[];const v={float5:.09,float4:.24,float3:.28,float2:.24,float1:.15};export function openCaseNavigateAway(){for(let t=0;t<h.length;t++){const n=e(h[t]);o({message:q("span",[q("span","You opened a "),q("span",{text:n.name,style:{color:i[n.rarity].color}}),q("span","!").parentNode]),icon:"case_winnings"});d.noSpoilers=false}h=[]}let y=0;export function openCase(n,i,o){let c=e(n);if(!o){l("opencase",false,false,true);d.noSpoilers=true}if(c.type!=="case"&&c.type!=="capsule")return;let v=[];u.innerHTML="";u.classList.remove("opening-finished");for(let l=0;l<i;l++){if(!(f.inventory.includes(n)&&(!c.keyName||f.inventory.includes(c.keyName))))continue;if(c.type==="case")a("opened_cases");if(c.type==="capsule")a("opened_capsules");let i=u.q(".opencase-wheel");let l=i.q(".opencase-wheel-scroller");let p;let w={};for(let t=0;t<c.content.items.length;t++){if(e(c.content.items[t]).stattrak)continue;let n=e(c.content.items[t]).rarity;if(!w[n])w[n]=[];w[n].push(c.content.items[t])}let x=Object.keys(w).map((e=>parseInt(e))).sort();let j=-1;f.inventory.splice(f.inventory.indexOf(n),1);if(c.keyName)f.inventory.splice(f.inventory.indexOf(c.keyName),1);if(o){const e=g(w,x);t(e.name);let n=e.price/Math.max(Math.log(e.price/10),10)/3*f.upgrades.xpmul;f.xp+=n;a("earned_xp",n);a("opened_rarities_"+e.rarity);v.push(e);continue}for(let e=0;e<100;e++){const n=g(w,x);let i=s(n,{clickable:e===85});l.appendChild(i);if(e===85){j=i.offsetLeft;i.classList.add("case-item-won");p=n.name;h.push(p);t(n.name);let e=n.price/Math.max(Math.log(n.price/10),10)/3;y+=e*f.upgrades.xpmul;a("opened_rarities_"+n.rarity)}}let k=(m||window.innerHeight<=650?103:153)*Math.random();let M=()=>{if(!l){window.removeEventListener("resize",M);return}l.style.transform="translateX(-"+(j-i.offsetWidth/2+k)+"px)"};setTimeout(M,100);window.addEventListener("resize",M);setTimeout((()=>{l.classList.add("opening-finished");l.style.transition="0s";f.xp+=y;a("earned_xp",y);d.noSpoilers=false;y=0;h.splice(h.indexOf(p),1);r.emit("update",true)}),1e4)}if(o){p({title:"Items from "+i+" containers!",returnBtn:{text:"Go to inventory",page:"inventory"},items:v,sortBy:"value"});r.emit("update",true)}r.once("showPage",(()=>{f.xp+=y;a("earned_xp",y);y=0}))}function g(t,i){let s;let o=Math.random();if(o<.8)s=Math.floor(Math.random()*3);else if(o<.96)s=3;else if(o<.98)s=4;else if(o<.994)s=5;else s=6;while(!i.includes(s)){if(s<i[0]){s=i[0];break}s-=1}let a=t[s][Math.floor(Math.random()*t[s].length)];let r=e(a);if(r.type==="skin"){let t=false;if(Math.random()<.1&&r.stattrakAvailable)t=true;let i=false;if(Math.random()<.02&&r.souvenirAvailable)i=true;if(r.skin==="Vanilla")return e((t?"StatTrak ":"")+r.short+" (Vanilla)");let s;o=Math.random();if(o<v.float5)s=5;else if(o<v.float5+v.float4)s=4;else if(o<v.float5+v.float4+v.float3)s=3;else if(o<v.float5+v.float4+v.float3+v.float2)s=2;else s=1;let a=-1;while(!r.qualities.includes(s)&&s<=5){if(s===0)a=1;s+=a}if(s>5||s<1)alert("Something went wrong, please report this on the discord! "+"QOFR:"+s+"&"+a+"I:"+r.name);let l=(t?"StatTrak ":"")+(i?"Souvenir ":"")+r.short+" ("+n[s]+")";let f=e(l);if(f.isUnknown&&t){console.log("Couldn't find "+l+", trying non-stattrak version.");f=e((i?"Souvenir ":"")+r.short+" ("+n[s]+")")}return f}else if(r.type==="sticker"){return r}}